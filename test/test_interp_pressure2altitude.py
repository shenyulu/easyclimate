"""
pytest for interp.pressure2altitude.py
"""

import pytest

import easyclimate as ecl
import numpy as np
import xarray as xr

z_data = xr.DataArray(
    np.array(
        [
            214.19354,
            841.6774,
            1516.871,
            3055.7097,
            4260.5806,
            5651.4194,
            7288.032,
            9288.193,
            10501.097,
            11946.71,
            13762.322,
            16233.451,
            18370.902,
            20415.227,
            23619.033,
            26214.322,
            30731.807,
        ]
    ),
    dims=("level"),
    coords={
        "level": np.array(
            [
                1000.0,
                925.0,
                850.0,
                700.0,
                600.0,
                500.0,
                400.0,
                300.0,
                250.0,
                200.0,
                150.0,
                100.0,
                70.0,
                50.0,
                30.0,
                20.0,
                10.0,
            ]
        )
    },
)
uwnd_data = xr.DataArray(
    np.array(
        [
            -2.3200073,
            -3.5700073,
            -2.5800018,
            8.080002,
            14.059998,
            22.119995,
            33.819992,
            49.339996,
            57.86,
            64.009995,
            62.940002,
            49.809998,
            31.160004,
            16.59999,
            10.300003,
            10.459991,
            9.880005,
        ]
    ),
    dims=("level"),
    coords={
        "level": np.array(
            [
                1000.0,
                925.0,
                850.0,
                700.0,
                600.0,
                500.0,
                400.0,
                300.0,
                250.0,
                200.0,
                150.0,
                100.0,
                70.0,
                50.0,
                30.0,
                20.0,
                10.0,
            ]
        )
    },
)


def test_interp1d_vertical_pressure2altitude():
    target_heights = np.linspace(0, 10000, 101)
    result_data = ecl.interp.interp1d_vertical_pressure2altitude(
        z_data=z_data,
        variable_data=uwnd_data,
        target_heights=target_heights,
        vertical_input_dim="level",
        vertical_output_dim="altitude",
    )
    refer_data = np.array(
        [
            -1.62144403,
            -1.95839842,
            -2.27662081,
            -2.5715752,
            -2.83872558,
            -3.07353596,
            -3.27147036,
            -3.42799276,
            -3.53856718,
            -3.59865762,
            -3.60372809,
            -3.54924259,
            -3.43066512,
            -3.24345969,
            -2.9830903,
            -2.64502095,
            -2.22597055,
            -1.73105429,
            -1.16883255,
            -0.54787619,
            0.12324392,
            0.83595692,
            1.58169195,
            2.35187814,
            3.13794463,
            3.93132056,
            4.72343507,
            5.50571728,
            6.26959634,
            7.00650139,
            7.70786156,
            8.3653115,
            8.97676994,
            9.54745,
            10.08297379,
            10.58896343,
            11.07104104,
            11.53482871,
            11.98594858,
            12.43002274,
            12.87267333,
            13.31952244,
            13.77619219,
            14.24823926,
            14.73858676,
            15.24668401,
            15.77174282,
            16.31297497,
            16.86959227,
            17.4408065,
            18.02582947,
            18.62387297,
            19.23414879,
            19.85586874,
            20.4882446,
            21.13048817,
            21.78181125,
            22.44143667,
            23.10885889,
            23.78385428,
            24.46621225,
            25.15572225,
            25.85217371,
            26.55535608,
            27.26505878,
            27.98107125,
            28.70318293,
            29.43118325,
            30.16486166,
            30.90400758,
            31.64841045,
            32.39785972,
            33.15214481,
            33.91105509,
            34.6743274,
            35.44155116,
            36.21229011,
            36.98610801,
            37.76256861,
            38.54123568,
            39.32167296,
            40.1034442,
            40.88611317,
            41.66924361,
            42.45239929,
            43.23514394,
            44.01704134,
            44.79765523,
            45.57654936,
            46.3532875,
            47.12743339,
            47.8985508,
            48.66620346,
            49.42995489,
            50.18915079,
            50.94252301,
            51.68869596,
            52.42629411,
            53.15394187,
            53.8702637,
            54.57388404,
        ]
    )
    assert np.isclose(result_data, refer_data).all()


def test_interp1d_vertical_pressure2altitude_linear_rs():
    target_heights = np.linspace(0, 10000, 101)
    result_data = ecl.interp.interp1d_vertical_pressure2altitude_linear_rs(
        z_data=z_data,
        variable_data=uwnd_data,
        target_heights=target_heights,
        vertical_input_dim="level",
        vertical_output_dim="altitude",
    ).data
    refer_data = np.array(
        [
            -2.3200073,
            -2.3200073,
            -2.3200073,
            -2.4909409,
            -2.69014921,
            -2.88935752,
            -3.08856583,
            -3.28777414,
            -3.48698246,
            -3.48449154,
            -3.33786611,
            -3.19124068,
            -3.04461526,
            -2.89798983,
            -2.7513644,
            -2.60473898,
            -2.00414193,
            -1.31141151,
            -0.61868109,
            0.07404933,
            0.76677975,
            1.45951017,
            2.1522406,
            2.84497102,
            3.53770144,
            4.23043186,
            4.92316228,
            5.6158927,
            6.30862312,
            7.00135354,
            7.69408396,
            8.29982291,
            8.79614131,
            9.29245971,
            9.78877812,
            10.28509652,
            10.78141492,
            11.27773332,
            11.77405173,
            12.27037013,
            12.76668853,
            13.26300693,
            13.75932533,
            14.28843586,
            14.86794206,
            15.44744825,
            16.02695445,
            16.60646064,
            17.18596684,
            17.76547303,
            18.34497923,
            18.92448542,
            19.50399161,
            20.08349781,
            20.663004,
            21.2425102,
            21.82201639,
            22.46729336,
            23.18218441,
            23.89707546,
            24.61196651,
            25.32685756,
            26.04174861,
            26.75663966,
            27.47153071,
            28.18642176,
            28.90131281,
            29.61620386,
            30.33109491,
            31.04598596,
            31.76087701,
            32.47576806,
            33.19065911,
            33.91285623,
            34.68879397,
            35.4647317,
            36.24066944,
            37.01660718,
            37.79254491,
            38.56848265,
            39.34442039,
            40.12035812,
            40.89629586,
            41.6722336,
            42.44817134,
            43.22410907,
            44.00004681,
            44.77598455,
            45.55192228,
            46.32786002,
            47.10379776,
            47.87973549,
            48.65567323,
            49.42293388,
            50.12538057,
            50.82782726,
            51.53027395,
            52.23272064,
            52.93516733,
            53.63761402,
            54.34006071,
        ]
    )
    assert np.isclose(result_data, refer_data).all()
